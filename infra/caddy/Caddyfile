:80 {
    encode gzip

    # API маршруты идут к backend
    @api path /api/*
    handle @api {
        reverse_proxy backend:{$BACKEND_PORT}
    }

    # Алиас для health endpoint (совместимость с TK-001 требованиями)
    handle_path /api/health {
        reverse_proxy backend:{$BACKEND_PORT}/api/v1/health
    }

    # Остальные маршруты идут к frontend
    handle {
        reverse_proxy frontend:{$FRONTEND_PORT}
    }

    # Логирование доступа
    log {
        format json
    }
}
