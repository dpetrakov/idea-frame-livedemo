## PRD: Система фрейминга портфеля инициатив (MVP)

### 1. Контекст и цели
- **Зачем**: упорядочить портфель инициатив команды, быстро фиксировать идеи, обсуждать и оценивать их.
- **Что**: создание инициатив с описанием в Markdown, чат‑комментарии, оценка атрибутов 1–5, автоматический расчёт веса, назначение ответственного.
- **Граница**: веб‑клиент с упрощённой регистрацией и авторизацией по JWT (24 часа).
- **Критерий успеха**: за 1–2 минуты пользователь создаёт инициативу, получает вес и делится ссылкой для обсуждения.

### 2. Роли и персоны
- **Пользователь (участник команды)**: может создавать инициативы, комментировать, назначать/менять атрибуты и ответственного, фильтровать и сортировать список. Различий прав нет.

### 3. Ключевые пользовательские сценарии
- **US1: Создать инициативу** — оформить название и описание (Markdown) и опубликовать.
- **US2: Прокомментировать инициативу** — вести обсуждение в виде чата в карточке инициативы.
- **US3: Оценить атрибуты** — выставить ценность, скорость, стоимость (1–5); вес пересчитывается.
- **US4: Назначить ответственного** — выбрать одного пользователя за реализацию инициативы.
- **US5: Просмотреть список** — отфильтровать (Все/Я предложил/Назначенные на меня) и отсортировать по весу.
- **US6: Зарегистрироваться/войти** — зарегистрироваться на экране логина и авторизоваться (JWT 24ч).

### 4. Функциональные требования (FR) и критерии приёмки (AC)

- **FR1. Регистрация и вход**
  - Поля регистрации на экране логина: логин, отображаемое имя, пароль, подтверждение пароля.
  - Пароль вводится дважды; проверки совпадения и минимальной длины (≥ 8 символов).
  - Авторизация по JWT; срок жизни токена — 24 часа.
  - AC:
    1) При корректной регистрации создаётся пользователь и выполняется вход. 
    2) При несовпадении паролей показана валидационная ошибка без перезагрузки. 
    3) Успешный вход возвращает JWT с exp ≈ 24ч. 
    4) По истечении срока токен недействителен, требуется повторный вход.
  - Пример: пользователь registrирует login "ivan", display name "Иван", получает JWT на 24ч.

- **FR2. Создание и редактирование инициативы**
  - Поля: название (1–120 символов, обязательно), описание в Markdown (0–5000 символов), автор‑инициатор — текущий пользователь.
  - Поддержка базового Markdown (заголовки, списки, ссылки, выделение).
  - Редактирование названия/описания доступно автору и любому пользователю (единая роль).
  - AC:
    1) При пустом названии кнопка «Сохранить» неактивна. 
    2) Сохранение отображает обновлённые данные без перезагрузки страницы. 
    3) Markdown рендерится в карточке инициативы. 
    4) В истории изменения не обязательны (MVP).
  - Пример: пользователь вводит «Улучшить онбординг», описание со списком; карточка показывает отформатированный текст.

- **FR3. Комментарии (чат)**
  - В карточке инициативы доступна лента комментариев (по возрастанию времени), поле ввода и отправка.
  - Комментарий содержит автора, текст, время создания; редактирование/удаление не требуется (MVP).
  - Обновление ленты может быть при отправке или по ручному обновлению (реал‑тайм не обязателен).
  - AC:
    1) Новый комментарий появляется вверху/внизу согласно хронологии. 
    2) Пустые сообщения не отправляются. 
    3) Автор и метка времени отображаются.
  - Пример: «Идея отличная, давайте оценим стоимость» — сообщение добавлено в чат.

- **FR4. Атрибуты и расчёт веса**
  - Атрибуты инициативы: ценность, скорость реализации, стоимость — целые значения 1 (низкое) … 5 (высокое).
  - Значения может назначать любой пользователь; действуют как текущие значения инициативы (не пер‑пользовательские).
  - Итоговый вес рассчитывается формулой: \(weight = round(0.5\cdot value + 0.3\cdot speed + 0.2\cdot (6 - cost), 2)\).
  - AC:
    1) При изменении любого атрибута вес пересчитывается мгновенно. 
    2) Атрибуты принимают только 1..5; вне диапазона — валидационная ошибка. 
    3) Вес отображается числом с точностью до двух знаков. 
    4) Сортировка по весу учитывает дробные значения.
  - Пример: value=5, speed=4, cost=3 → weight = round(0.5*5 + 0.3*4 + 0.2*(3), 2) = 4.3.

- **FR5. Назначение ответственного**
  - В карточке инициативы можно выбрать одного ответственного пользователя (опционально).
  - Ответственный отображается в списке и карточке; может быть снят/изменён.
  - AC:
    1) Выбор ответственного из списка пользователей. 
    2) В фильтре «Назначенные на меня» показываются инициативы, где текущий пользователь — ответственный. 
    3) При снятии назначения инициатива удаляется из этого фильтра.
  - Пример: назначить «Анна Петрова» ответственной — метка появляется в списке.

- **FR6. Список инициатив: фильтры и сортировка**
  - Фильтры: «Все», «Я предложил» (инициатор = текущий пользователь), «Назначенные на меня» (ответственный = текущий пользователь).
  - Сортировка по умолчанию: по весу по убыванию; вторичная — по дате создания по убыванию.
  - Карточка списка показывает: название, вес, ответственного (если есть), атрибуты.
  - AC:
    1) Переключение фильтров меняет набор карточек без перезагрузки. 
    2) Сортировка по умолчанию — вес (desc). 
    3) При равном весе выше — более новая инициатива.
  - Пример: в «Я предложил» видны только инициативы текущего пользователя, отсортированные по весу.

### 5. UX и состояния интерфейса
- **Экраны**: 
  - Логин/регистрация (единый экран с табом/переключателем). 
  - Список инициатив (мобильный список карточек, фильтры сверху). 
  - Карточка инициативы (описание Markdown, атрибуты 1–5, ответственный, чат).
- **Состояния**: загрузка (скелетоны), пусто (подсказки), ошибка (toast/inline), успех (toast/inline).
- **Контролы**: селект 1–5 для атрибутов (пять кнопок/пилюли), выбор ответственного (поиск/выпадающий список), поле комментария с кнопкой «Отправить».
- **Мобильный вид**: ширина 360–414 px, без горизонтального скролла; крупные цели нажатия (≥ 44px), контрастные подписи, одно действие на экран.

### 6. Данные и правила (минимальная модель)

- **Сущности**: user, initiative, comment.

| Поле (user) | Тип | Обяз. | Пример | Примечание |
|---|---|---:|---|---|
| id | uuid | да | 3b1e… | первичный ключ |
| login | string(3–32) | да | ivan | уникальный, латиница/цифры/._- |
| display_name | string(1–64) | да | Иван Петров | отображаемое имя |
| password_hash | string | да | — | хранится хеш |
| created_at | timestamp | да | 2025-09-19T10:00:00Z | — |

| Поле (initiative) | Тип | Обяз. | Пример | Примечание |
|---|---|---:|---|---|
| id | uuid | да | 9a7c… | первичный ключ |
| title | string(1–120) | да | Улучшить онбординг | — |
| description_md | text(≤5000) | нет | … | Markdown |
| proposer_user_id | uuid | да | 3b1e… | автор‑инициатор |
| responsible_user_id | uuid | нет | 5d2a… | ответственный |
| value_score | int(1–5) | нет | 4 | атрибут |
| speed_score | int(1–5) | нет | 3 | атрибут |
| cost_score | int(1–5) | нет | 2 | атрибут |
| weight | number(0–5,2) | нет | 4.30 | вычисляемое поле |
| created_at | timestamp | да | 2025-09-19T10:00:00Z | — |
| updated_at | timestamp | да | 2025-09-19T10:05:00Z | — |

| Поле (comment) | Тип | Обяз. | Пример | Примечание |
|---|---|---:|---|---|
| id | uuid | да | c12f… | первичный ключ |
| initiative_id | uuid | да | 9a7c… | ссылка на инициативу |
| author_user_id | uuid | да | 3b1e… | автор |
| body | string(1–1000) | да | Идея отличная… | текст |
| created_at | timestamp | да | 2025-09-19T10:02:00Z | — |

- **Правила и вычисления**:
  - Диапазон атрибутов: 1..5 (1 — низкое, 5 — высокое).
  - Инверсия стоимости в формуле: (6 - cost).
  - Формула веса: \(weight = round(0.5\cdot value + 0.3\cdot speed + 0.2\cdot (6 - cost), 2)\).
  - Пример пересчёта: value=5, speed=2, cost=5 → weight = round(2.5 + 0.6 + 0.2, 2) = 3.30.
- **Сортировки/фильтры**:
  - По умолчанию сортировка weight desc, затем created_at desc.
  - Фильтры: Все / Я предложил / Назначенные на меня.

### 7. Нефункциональные требования (простота и надёжность)
- **Простота**: минимальные формы; ясные подписи; действие всегда видно; безопасные значения по умолчанию.
- **Надёжность**: предсказуемые сообщения об ошибках; автоповтор только для чтения; восстановление состояния после обновления.
- **Адаптивность**: mobile‑first, без горизонтального скролла, доступные размеры кликов.
- **Наблюдаемость**: логирование ошибок на бэкенде; простые health‑чеки.

### 8. Ограничения и допущения
- Веб‑клиент (SPA), одна роль; все пользователи имеют одинаковые права.
- Атрибуты — единые для инициативы; «последняя правка побеждает» (без консенсуса/голосования в MVP).
- Реал‑тайм обновления (websocket) не требуются в MVP; допустим «submit → обновилось».
- Нет уведомлений, почты, восстановления пароля, SSO (вне скоупа MVP).
- Нет вложений/файлов, тегов, поиска и админ‑панели (вне скоупа MVP).
- Поддержка базового Markdown; расширенные блоки (таблицы, код) — опционально и вне MVP.

---

### Чек‑лист готовности PRD
- [x] Для каждого сценария есть FR и AC.
- [x] Поля и ограничения перечислены таблицами; есть примеры значений.
- [x] Вычисления заданы формулой и примерами.
- [x] NFR только про простоту/надёжность/адаптивность/наблюдаемость.
- [x] Out of Scope определён.

